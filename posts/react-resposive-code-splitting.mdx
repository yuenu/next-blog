---
title: Reactå¦‚ä½•åœ¨åŒä¸€å€‹Repoç”¨æ‹†åˆ†ä¸åŒè£ç½®çš„Code
subtitle: Desktop èˆ‡ Mobile(h5)ç‰ˆæœ¬ï¼Œä½¿ç”¨ä¸åŒçš„domainï¼Œä¹Ÿæ‹†åˆ†äº†ä¸åŒçš„å°ˆæ¡ˆï¼Œè¦å¦‚ä½•æ•´åˆåœ¨ä¸€èµ·ï¼Ÿ
image: /images/post/react-resposive-code-splitting/post.jpg
date: 2023-05-24
slug: react-resposive-code-splitting
tags: react/code splitting/react.lazing
published: true
---

## æ­¤æ–‡ç« é©ç”¨ä»¥ä¸‹æƒ…å¢ƒ

- é›»è…¦ç‰ˆèˆ‡æ‰‹æ©Ÿç‰ˆç”¨åˆ°çš„ API åŠå•†æ¥­é‚è¼¯å¤§è‡´ç›¸åŒï¼Œä½†æ˜¯å»æ‹†åˆ†äº† 2 å€‹å°ˆæ¡ˆï¼Œä¹Ÿå„è‡ªä¸Šå‚³åˆ°ä¸åŒçš„ Domain

- 2 å€‹ä¸åŒçš„å°ˆæ¡ˆç”±`+3`å€‹äººåŒæ™‚ç¶­è­·ï¼Œç¶­è­·äººå“¡åƒå·®ä¸é½Š

- æ²’æœ‰ç‰¹åˆ¥ç‚ºæ¯å€‹ core functionã€component å¯«æ¸¬è©¦

- æ²’æœ‰ç‰¹åˆ¥çš„äººå“¡ä¾†åš Code review

## æ¡ˆä¾‹åˆ†æ

### ç¶­è­·å•é¡Œ

A å°ˆæ¡ˆ(é›»è…¦ç‰ˆã€Desktop version)

B å°ˆæ¡ˆ(æ‰‹æ©Ÿç‰ˆã€Mobile version)

å°ˆæ¡ˆæœƒæ‹†åˆ†æˆ 2 å€‹ä¸åŒçš„å°ˆæ¡ˆï¼Œæ‰€ä»¥è‹¥è¦åŠ ä¸Šæ–°åŠŸèƒ½çš„è©±å¿…é ˆå…©å€‹å°ˆæ¡ˆéƒ½è¦ç¶­è­·ï¼Œè¦–å°ˆæ¡ˆå¤§å°æœ‰å¯èƒ½æœƒæœ‰ä¸åª 2 ä½ä»¥ä¸Šäººå“¡åŒæ™‚åœ¨ç¶­è­·ï¼Œä¸¦ä¸”äº¤å‰ç¶­è­·(åŒæ™‚ç¶­è­· A å°ˆæ¡ˆåŠ B å°ˆæ¡ˆ)ï¼Œè‹¥æ²’æœ‰åšå¥½ä»£ç¢¼ç®¡ç†çš„è©±ï¼Œå¾ŒçºŒçš„ç¶­è­·æœƒæ˜¯ä¸€å€‹å¤§ç½é›£

> åŸºæœ¬ä¸Šæœƒé‡åˆ°é€™ç¨®å°ˆæ¡ˆé¡å‹çš„éƒ½æ˜¯æ¯”è¼ƒèˆŠçš„å°ˆæ¡ˆï¼Œå› ç‚ºé‚£æ™‚å€™æ¯”è¼ƒæ²’æœ‰[RWD](https://zh.wikipedia.org/zh-tw/%E5%93%8D%E5%BA%94%E5%BC%8F%E7%BD%91%E9%A1%B5%E8%AE%BE%E8%AE%A1)çš„æ¦‚å¿µï¼ŒåŠ ä¸Šæ‰‹æ©Ÿç«¯çš„ç”¨æˆ¶èˆˆèµ·ï¼Œæ¯å€‹ç¶²ç«™éƒ½å¿…é ˆè¦æ”¯æ´æ‰‹æ©Ÿç«¯çš„ç¶²é ï¼Œå› æ­¤åŸæœ¬åªæœ‰è¨­è¨ˆé›»è…¦ç‰ˆçš„å…¬å¸åœ¨ä¸å¹²æ“¾åŸæœ¬ç¨‹å¼ç¢¼çš„æƒ…å½¢ï¼Œä¾¿åˆ©ç”¨è¦–çª—å¤§å°ä¾†ç¢ºèªã€‚æ‰€ä»¥ä¾¿æ‹†åˆ†äº†å…©ç¨®ç‰ˆæœ¬ï¼Œè€Œéš¨è‘—å°ˆæ¡ˆè¶Šä¾†è¶Šå¤§ä¹Ÿç„¡æ³•éš¨æ„åˆä½µåœ¨ä¸€èµ·ï¼Œä¹‹å¾Œè¶Šèµ°è¶Šé ç›´è‡³å¹³è¡Œã€‚

åŸºæœ¬ä¸Šé‡åˆ°é€™ç¨®æƒ…æ³åŠ ä¸Šç”¢å“é‚„åœ¨ç·šä¸Šçš„ï¼Œä¸å¯èƒ½æ”¹å°ˆæ¡ˆæ¶æ§‹ã€‚é™¤éé‡åˆ°å…¬å¸æ¥­ç¸¾å¤§å¹…è¡°é€€ï¼Œè€é—†ç™¼è¦ºä¸å¦™æ‰æœ‰å¯èƒ½é€²è¡Œä¸€äº›èª¿æ•´ã€‚

> è¦æ”¹çš„æ±è¥¿å¤ªå¤šäº†ï¼Œé‚£å°±æ”¹å¤©å§

ä½†åœ¨é€™éº¼è¬›ä¹Ÿä¸å¯èƒ½ç›´æ¥æ”¹æ¶æ§‹ï¼Œå› ç‚ºç”¢å“è¦è€ƒæ…®çš„é¢å‘å¤ªå¤šäº†ã€‚æ‰€ä»¥æˆ‘å€‘å¯ä»¥å¾æ–°å°ˆæ¡ˆé–‹å§‹ä½¿ç”¨é€™æ¨£çš„æ¶æ§‹ä¾†é¿å…æœªä¾†é¢è‡¨çš„æŠ€è¡“å‚µ

~~è¦æ”¹ï¼Ÿè€é—†èµ°~~

~~ä¸æ”¹ï¼Ÿä½ èµ°~~

### ä½¿ç”¨è€…é«”é©—å•é¡Œ

å¦‚ï¼š

- ç¶²å®¶ PCHome(Desktop) [https://24h.pchome.com.tw/](https://24h.pchome.com.tw/)

- ç¶²å®¶ PCHome(Mobile) [https://24h.m.pchome.com.tw/](https://24h.m.pchome.com.tw/)

- iT é‚¦å¹«å¿™(Desktop) [https://ithelp.ithome.com.tw/](https://ithelp.ithome.com.tw/)

- iT é‚¦å¹«å¿™(Mobile) [https://ithelp.ithome.com.tw/m/](https://ithelp.ithome.com.tw/m/)

å¯ä»¥è§€å¯Ÿåˆ°ä»¥ä¸Šç¶²å€ç„¡éå°±æ˜¯åœ¨ Domain ä¸ŠåŠ ä¸Š m ç•¶ä½œ mobile çš„æ¨™èªŒ

åœ¨ä¸€èˆ¬çš„æƒ…æ³ä¸‹é€™ç¨®æ–¹å¼æ˜¯æ²’æœ‰å•é¡Œçš„ï¼Œä½†æ˜¯å‡å¦‚ä½ åœ¨é›»è…¦ä¸Šé–‹äº†æ‰‹æ©Ÿç‰ˆçš„ Domain ï¼Œé é¢ä¾¿æœƒè®Šå¾—éå¸¸å¥‡æ€ª

![PC Home mobile page](/images/post/react-resposive-code-splitting/pchome.png)

åœ¨ SEO æ¬Šé‡çš„åˆ†é…ä¸‹æœ‰å¯èƒ½ Mobile çš„ Domain ä¸Šåˆ°äº†æœå°‹çµæœçš„ç¬¬ä¸€é ï¼Œç”¨æˆ¶é»äº†é é¢ä»¥ç‚ºæ­¤ç¶²ç«™æœ‰å•é¡Œï¼Œå°±ç›´æ¥é—œæ‰æ­¤ç¶²é 

![ithelp mobile page](/images/post/react-resposive-code-splitting/ithelp.png)

> æ³¨: æˆ‘å° SEO ç›¸é—œçš„å„ªåŒ–ä¸æ˜¯å¤ªäº†è§£ ğŸ˜“ ï¼Œä¹‹å‰çš„å·¥ä½œéƒ½æ˜¯ä½¿ç”¨ CSR(Client side render)çš„æ¡†æ¶

å°æ–¼ä»€éº¼æ˜¯ CSR é‚„æ˜¯ SSR é€™äº›åè©çš„äººï¼Œå¯ä»¥çœ‹é€™ [è‹±æ–‡](https://web.dev/rendering-on-the-web/)ã€[ç¹é«”ä¸­æ–‡](https://shubo.io/rendering-patterns/)ã€[æ˜é‡‘](https://juejin.cn/post/7127426806088466446)

## æ­£é¡Œé–‹å§‹ Show me the code

æ­¤ç¯‡ä¸¦æ²’æœ‰æ‰“ç®—ä½¿ç”¨ monorepo ç›¸é—œçš„æ¡†æ¶ä¾†è™•ç†ï¼Œä¸»è¦ä½¿ç”¨çš„æŠ€è¡“ç‚º

- [Vitejs](https://vitejs.dev/)

- [React.js](https://react.dev/)

> ä½†è‹¥ä½ æœ‰è€ƒæ…®ä½¿ç”¨ monorepo ï¼Œå¯ä»¥è€ƒæ…®[lerna](https://lerna.js.org/)ã€[Nx](https://nx.dev/)ã€[Turborepo](https://turbo.build/)ï¼Œå„æ¡†æ¶éƒ½æœ‰å„è‡ªçš„ trade offã€‚

æ­¤ç¯„ä¾‹ç”¨çš„ library ç‰ˆæœ¬ï¼Œä¸»è¦ç”¨ `Typescript` ï¼Œç”¨ js çš„å°å¤¥ä¼´å¯ä»¥è‡ªå·±åœ¨åšèª¿æ•´

```bash
# bash
â¯ node -v
v14.19.1
â¯ npm -v
7.24.2
```

Run `npm create vite@latest` å¾Œçš„ package.json

```json
// package.json
{
  // ...
  "dependencies": {
    "react": "^18.2.0",
    "react-dom": "^18.2.0",
    "react-router-dom": "^6.11.2"
  },
  "devDependencies": {
    "vite": "^4.3.2"
  }
}
```

åŠ å…¥ React-router-domã€@types/node

> React router è‡ªå¾ 6.4 ç‰ˆæœ¬å¾Œåšäº†è¨±å¤šæ”¹è®Šï¼Œä¹Ÿè¨±ä½ è©²çœ‹çœ‹ä»–å€‘çš„[æ–‡æª”](https://reactrouter.com/) ï¼Œ ä½†ç¾éšæ®µä¸å»ºè­°ä½¿ç”¨åœ¨ Prod ä¸Šé¢ï¼Œå› ç‚ºè¿‘æœŸä»–å€‘å°ç‰ˆæœ¬æ›´æ–°çš„é£›å¿«ï¼Œå¦‚æœè¦ç©©å®šä¸€é»çš„ç‰ˆæœ¬å»ºè­°é‚„æ˜¯ä½¿ç”¨ v5 ï¼Œé‡åˆ°å•é¡Œç¤¾ç¾¤ä¸Šçš„è§£ç­”ä¹Ÿç›¸å°æ¯”è¼ƒå¤šä¸€é»ã€‚

```bash
yarn add react-router-dom && yarn add -D @types/node
```

åŠ å…¥å¾Œæœƒè®Šæˆ

```json
// package.json
{
  // ...
  "dependencies": {
    "react": "^18.2.0",
    "react-dom": "^18.2.0",
    "react-router-dom": "^6.11.2"
  },
  "devDependencies": {
    "@types/node": "^20.2.3",
    "vite": "^4.3.2"
  }
}
```

æ¥è‘—èª¿æ•´ä¸€ä¸‹ vite.config.ts ä»¥åŠ tsconfig.json

```ts
// vite.config.ts
/** @type {import('vite').UserConfig} */

import { URL, fileURLToPath } from 'node:url'
import react from '@vitejs/plugin-react'
import { defineConfig } from 'vite'

// https://vitejs.dev/config/
export default defineConfig({
  plugins: [react()],
  resolve: {
    alias: [
      {
        find: '@',
        replacement: fileURLToPath(new URL('./src', import.meta.url)),
      },
    ],
  },
})
```

```json
// tsconfig.json
{
  "compilerOptions": {
    // ....
    // åŠ ä¸Šé€™å…©è¡Œï¼Œè®“ vscodeï¼Œèƒ½å¤ è‡ªå‹•æŠ“åˆ°ç›¸å°æ‡‰çš„è·¯å¾‘
    "baseUrl": ".",
    "paths": {
      "@/*": ["./src/*"]
    }
  }
}
```

.eslintrc.cjs æœƒå™´éŒ¯ï¼Œå…ˆä¿®æ­£ä¸€ä¸‹

> 'module' is not defined. eslint (no-undef)

```js
// .eslintrc.cjs
module.exports = {
  env: { browser: true, es2020: true, node: true }, // åŠ ä¸Š node: true
  // ...
}
```

åˆ°é€™é‚Šå°ˆæ¡ˆçš„åˆå§‹è¨­å®šç®—æ˜¯å¥½äº†

### ä¸»é‚è¼¯
