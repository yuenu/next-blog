---
title: React如何在同一個Repo用同一份Code拆分電腦版與手機版
subtitle: Desktop 與 Mobile(h5)版本，使用不同的domain，也拆分了不同的專案，要如何整合在一起？
image: /images/post/react-resposive-code-splitting/post.jpg
date: 2023-05-24
slug: react-resposive-code-splitting
tags: react/code splitting
published: true
---

## 此文章適用以下情境

- 電腦版與手機版用到的 API 及商業邏輯大致相同，但是卻拆分了 2 個專案，也各自上傳到不同的 Domain

- 2 個不同的專案由`+3`個人同時維護，維護人員參差不齊

- 沒有特別為每個 component 寫測試

- 沒有特別的人員來做 Code review

## 案例分析

### 維護問題

A 專案(電腦版、Desktop version)

B 專案(手機版、Mobile version)

專案會拆分成 2 個不同的專案，所以若要加上新功能的話必須兩個專案都要維護，視專案大小有可能會有不只 2 位以上人員同時在維護，並且交叉維護(同時維護 A 專案及 B 專案)，若沒有做好代碼管理的話，後續的維護會是一個大災難

> 基本上會遇到這種專案類型的都是比較舊的專案，因為那時候比較沒有[RWD](https://zh.wikipedia.org/zh-tw/%E5%93%8D%E5%BA%94%E5%BC%8F%E7%BD%91%E9%A1%B5%E8%AE%BE%E8%AE%A1)的概念，加上手機端的用戶興起，每個網站都必須要支援手機端的網頁。所以便拆分了兩種版本，而隨著專案越來越大也無法隨意合併在一起，之後越走越遠直至平行。

基本上遇到這種情況加上產品還在線上的，不可能改專案架構。

~~要改？老闆走~~

~~不改？你自己走~~

### 使用者體驗問題

如：

- 網家 PCHome(Desktop) [https://24h.pchome.com.tw/](https://24h.pchome.com.tw/)

- 網家 PCHome(Mobile) [https://24h.m.pchome.com.tw/](https://24h.m.pchome.com.tw/)

- iT 邦幫忙(Desktop) [https://ithelp.ithome.com.tw/](https://ithelp.ithome.com.tw/)

- iT 邦幫忙(Mobile) [https://ithelp.ithome.com.tw/m/](https://ithelp.ithome.com.tw/m/)

可以觀察到以上網址無非就是在 Domain 上加上 m 當作 mobile 的標誌

在一般的情況下這種方式是沒有問題的，但是假如你在電腦上開了手機版的 Domain ，頁面便會變得非常奇怪

![PC Home mobile page](/images/post/react-resposive-code-splitting/pchome.png)

在 SEO 瀏覽器權重的分配下有可能 Mobile 的 Domain 上到了搜尋結果的第一頁，用戶點了頁面以為此網站有問題，就直接關掉此網頁

> 注: 我對 SEO 不是太了解 😓 ，之前的工作都是使用 CSR(Client side render)的框架

對於什麼是 CSR 還是 SSR 這些名詞的人，可以看這 [英文](https://web.dev/rendering-on-the-web/)、[繁體中文](https://shubo.io/rendering-patterns/)、[掘金](https://juejin.cn/post/7127426806088466446)

![ithelp mobile page](/images/post/react-resposive-code-splitting/ithelp.png)

## 正題開始

`Show me the code`

此篇主要使用的技術為

- [Vitejs](https://vitejs.dev/)

- [React.js](https://react.dev/)

並沒有打算使用 monorepo 相關的框架來處理

待補....
